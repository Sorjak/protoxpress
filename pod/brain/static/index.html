<html>
    <head>
        <style>
            /* Style for the new group container */
            #main-controls-ui {
                width: 1280px;
                height: 800px;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                border: 1px solid #ccc;
                padding: 10px;
                box-sizing: border-box;
            }

            /* Style for the main-controls-ui-row */
            #main-controls-ui-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-gmain-controls-ui-row: 1;
            }

            /* Style for the columns */
            #main-controls-ui-col-1 {
                flex: 1;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #main-controls-ui-col-2 {
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 10px;
            }

            /* Style for the right-justified button */
            #secret-party-mode-btn {
                align-self: flex-end;
            }

            /* Style for the image */
            #main-controls-ui-col-1 img {
                max-width: 100%;
                max-height: 100%;
            }

            /* Ensure the photo-mode image fits within a 1280x800 square and is left-justified */
            #photo-mode-ui img {
                width: 100%;
                height: 100%;
                max-width: 1280px;
                max-height: 800px;
                object-fit: contain;
                display: block;
                margin: 0;
            }

            /* Hide groups by default */
            #screensaver-container,
            #main-controls-ui,
            #photo-mode-ui {
                display: none;
            }
        </style>
    </head>
    <body>
        <h1>ProtoXpress</h1>

        <p>Send Action:</p>
        <ul id="action-list"></ul>

        <button id="test-ui-btn">Test UI</button>
        <div id="screensaver-container" style="display: none;">
            <video id="screensaver-vp" autoplay loop muted style="width: 1280px; height: 800px;">
                <source src="videos/dvd-old.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>

        <div id="main-controls-ui">
            <div id="main-controls-ui-row">
                <div id="main-controls-ui-col-1">
                    <img src="path/to/image.jpg" alt="Example Image">
                </div>
                <div id="main-controls-ui-col-2">
                    <button id="photo-mode-btn">Photo Mode</button>
                    <button id="start-sequence-btn">Start Sequence</button>
                    <button id="do-not-touch-btn">DO NOT TOUCH</button>
                </div>
            </div>
            <button id="secret-party-mode-btn">Party Time</button>
        </div>

        <div id="photo-mode-ui">
            <img src="path/to/photo-mode-image.jpg" alt="Photo Mode Image" style="width: 100%; height: auto;">
            <button id="return-to-main-btn">Return to Main</button>
        </div>

    </body>

    <script type="text/javascript">
        const action_url = '/api/actions'
        async function setAction(action) {
            console.log(`Setting action ${action}`);

            const response = await fetch(action_url, {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({'action': action.toLowerCase()})
            });

            if (!response.ok) { 
                console.error(response.json()); return; 
            }

            console.log(await response.json());
            return;
        }

        async function createActionLinks() {
            console.log(`Getting actions`);
            const response = await fetch(action_url, {method: 'GET'});
            if (!response.ok) { 
                console.error(response.json()); return; 
            }

            console.log('Creating links');
            const listElem = document.getElementById('action-list');
            const json_data = await response.json();
            json_data.msg.forEach((x) => {
                listElem.insertAdjacentHTML('beforeend', `<li><a class="api-link" href="#">${x}</a></li>`)
            });

            var els = document.getElementsByClassName("api-link");
            console.log(els);

            [].forEach.call(els, function(el) {
                el.onclick = (evt) => {
                    evt.preventDefault();
                    setAction(evt.target.innerText);
                }
            });
        }

        createActionLinks();

        // Add logic to play the video when the button is clicked
        const testUiBtn = document.getElementById('test-ui-btn');
        const screensaverContainer = document.getElementById('screensaver-container');
        const screensaverVp = document.getElementById('screensaver-vp');

        testUiBtn.addEventListener('click', () => {
            screensaverVp.currentTime = 0; // Reset video to the beginning
            screensaverContainer.style.display = 'block';
            hideVideoBtn.style.display = 'inline-block';
            screensaverVp.play(); // Ensure the video starts playing
        });

        // Add logic to hide the video when clicking on it
        screensaverVp.addEventListener('click', () => {
            screensaverContainer.style.display = 'none';
            screensaverVp.pause();
            screensaverVp.currentTime = 0;

            // Show the main-controls-ui group
            const mainControls = document.getElementById('main-controls-ui');
            mainControls.style.display = 'flex';

            // Release video resources
            screensaverVp.removeAttribute('src'); // Remove the video source
            screensaverVp.load(); // Stop loading and release resources
        });

        // Add event listeners for the new buttons
        document.getElementById('photo-mode-btn').addEventListener('click', () => {
            console.log('Photo Mode clicked');

            // Hide the main-controls-ui group
            const mainControls = document.getElementById('main-controls-ui');
            mainControls.style.display = 'none';

            // Show the photo-mode-ui group
            const photoModeUi = document.getElementById('photo-mode-ui');
            photoModeUi.style.display = 'block';
        });

        document.getElementById('start-sequence-btn').addEventListener('click', () => {
            console.log('Start Sequence clicked');
        });

        document.getElementById('do-not-touch-btn').addEventListener('click', () => {
            console.log('Do Not Touch clicked');
        });

        document.getElementById('secret-party-mode-btn').addEventListener('click', () => {
            console.log('Secret Party Mode clicked');
        });

        document.getElementById('return-to-main-btn').addEventListener('click', () => {
            console.log('Return to Main clicked');

            // Check if photo-mode-ui is active
            const photoModeUi = document.getElementById('photo-mode-ui');
            if (photoModeUi.style.display === 'block') {
                console.log('returning from photo mode');
            }

            // Hide all groups
            const groups = ['screensaver-container', 'main-controls-ui', 'photo-mode-ui'];
            groups.forEach(groupId => {
                const group = document.getElementById(groupId);
                if (group) group.style.display = 'none';
            });

            // Show the main-controls-ui group
            const mainControls = document.getElementById('main-controls-ui');
            mainControls.style.display = 'flex';
        });
    </script>

</html>
