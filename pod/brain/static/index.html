<html>
    <head>
        <style>
            /* Style for the new group container */
            #main-controls {
                width: 1280px;
                height: 800px;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                border: 1px solid #ccc;
                padding: 10px;
                box-sizing: border-box;
            }

            /* Style for the main-controls-row */
            #main-controls-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-gmain-controls-row: 1;
            }

            /* Style for the columns */
            #main-controls-col-1 {
                flex: 1;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #main-controls-col-2 {
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 10px;
            }

            /* Style for the right-justified button */
            #secret-party-mode-btn {
                align-self: flex-end;
            }

            /* Style for the image */
            #main-controls-col-1 img {
                max-width: 100%;
                max-height: 100%;
            }
        </style>
    </head>
    <body>
        <h1>ProtoXpress</h1>

        <p>Send Action:</p>
        <ul id="action-list"></ul>

        <button id="play-video-btn">Play Video</button>
        <div id="screensaver-vp" style="display: none;">
            <video id="video-player" autoplay loop muted style="width: 1280px; height: 800px;">
                <source src="videos/dvd-old.mp4" type="video/mp4">
                Your bmain-controls-rowser does not support the video tag.
            </video>
        </div>

        <div id="main-controls">
            <div id="main-controls-row">
                <div id="main-controls-col-1">
                    <img src="path/to/image.jpg" alt="Example Image">
                </div>
                <div id="main-controls-col-2">
                    <button id="photo-mode-btn">Photo Mode</button>
                    <button id="start-sequence-btn">Start Sequence</button>
                    <button id="do-not-touch-btn">DO NOT TOUCH</button>
                </div>
            </div>
            <button id="secret-party-mode-btn">Party Time</button>
        </div>

    </body>

    <script type="text/javascript">
        const action_url = '/api/actions'
        async function setAction(action) {
            console.log(`Setting action ${action}`);

            const response = await fetch(action_url, {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({'action': action.toLowerCase()})
            });

            if (!response.ok) { 
                console.error(response.json()); return; 
            }

            console.log(await response.json());
            return;
        }

        async function createActionLinks() {
            console.log(`Getting actions`);
            const response = await fetch(action_url, {method: 'GET'});
            if (!response.ok) { 
                console.error(response.json()); return; 
            }

            console.log('Creating links');
            const listElem = document.getElementById('action-list');
            const json_data = await response.json();
            json_data.msg.forEach((x) => {
                listElem.insertAdjacentHTML('beforeend', `<li><a class="api-link" href="#">${x}</a></li>`)
            });

            var els = document.getElementsByClassName("api-link");
            console.log(els);

            [].forEach.call(els, function(el) {
                el.onclick = (evt) => {
                    evt.preventDefault();
                    setAction(evt.target.innerText);
                }
            });
        }

        createActionLinks();

        // Add logic to play the video when the button is clicked
        const playVideoBtn = document.getElementById('play-video-btn');
        const videoContainer = document.getElementById('screensaver-vp');
        const screensaverVp = document.getElementById('video-player');

        playVideoBtn.addEventListener('click', () => {
            screensaverVp.currentTime = 0; // Reset video to the beginning
            videoContainer.style.display = 'block';
            hideVideoBtn.style.display = 'inline-block';
            screensaverVp.play(); // Ensure the video starts playing
        });

        // Add logic to hide the video when clicking on it
        screensaverVp.addEventListener('click', () => {
            videoContainer.style.display = 'none';
            hideVideoBtn.style.display = 'none';
            screensaverVp.pause();
            screensaverVp.currentTime = 0;

            // Release video resources
            screensaverVp.removeAttribute('src'); // Remove the video source
            screensaverVp.load(); // Stop loading and release resources
        });

        // Add event listeners for the new buttons
        document.getElementById('photo-mode-btn').addEventListener('click', () => {
            console.log('Photo Mode clicked');
        });

        document.getElementById('start-sequence-btn').addEventListener('click', () => {
            console.log('Start Sequence clicked');
        });

        document.getElementById('do-not-touch-btn').addEventListener('click', () => {
            console.log('Do Not Touch clicked');
        });

        document.getElementById('secret-party-mode-btn').addEventListener('click', () => {
            console.log('Secret Party Mode clicked');
        });
    </script>

</html>
